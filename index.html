<!doctype html>

<head>
    <title>Cross Storage Hub</title>
</head>

<body>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.1.1.js" integrity="sha256-16cdPddA6VdVInumRGo6IbivbERE8p7CQR3HzTBuELA=" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script type="text/javascript" src="../lib/client.js"></script>
    <script type="text/javascript">
        var storage = new CrossStorageClient('http://localhost:3000/hub.html');

        var setToken = function() {
            var key = $("#uname").val();
            var value = $("#tkn").val()
            storage.set(key, value).then(function() {
                console.log("token set");
            });
        };

        function onChange() {
            var updatedVal = "http://localhost:3001/client2.html?uname=" + $("#uname").val();
            $("#redirect").attr("href", updatedVal);
        }
/*
        storage.onConnect()
            .then(setKeys)
            .then(function() {
                return storage.get('key1');
            }).then(function(res) {
                console.log(res); // 'foo'
            })['catch'](function(err) {
                console.log(err);
            });
*/
    </script>

    <div class="input-group input-group-lg">
        <span class="input-group-addon" id="sizing-addon1">Username</span>
        <input id="uname" onchange="onChange()" type="text" class="form-control" placeholder="logged-in userId or email address..." aria-describedby="sizing-addon1">
    </div>

    <br/>

    <div class="input-group input-group-lg">
        <span class="input-group-addon" id="sizing-addon1">Token</span>
        <input id="tkn" onChange="onChange()" type="text" class="form-control" placeholder="Token to pass..." aria-describedby="sizing-addon1">
    </div>

    <br/>

    <a id="redirect" href="" target="_blank" onclick="setToken()">Redirect</a>
</body>

</html>
